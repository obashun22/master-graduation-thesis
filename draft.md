# スマートフォンを用いたローイング競技向け衝突防止システム

## 第 1 章 序論

### 1.1 研究背景

#### ローイング競技とその現状

- ローイング競技の概要

  - ローイング競技（以下、ローイング）とは、オール（漕ぐやつ笑）を使って人力でボート（以下、艇）を漕ぎ進めその着順を競うスポーツである
  - 2000m の距離を 1 人、2 人、4 人、あるいは 8 人からなるチームで漕ぎ進める
  - 進行方向に対して背中を向けて漕ぐのが特徴である
  - ローイングで使用する艇には幾つかの種類があり、乗艇人数や COX の有無、オールの持ち方により種類分けされている // 前提知識の章で詳解すればいいかも

    - 乗艇人数は 1 人から 8 人まであり、加えて COX と呼ばれる指示・操船役が加わる場合もある
    - オールの持ち方はスカルとスイープの 2 種類あり、スカルは 左右それぞれの手で 1 本ずつオールを持ち、スイープは両手で 1 本のオールを持つ // 写真があるとわかりやすい
    - 乗艇人数と COX の有無、オールの持ち方の組み合わせにより、艇は次のように分類される

      | 艇種               | 艇種記号 | 乗艇人数 | COX の有無 | オールの持ち方 |
      | ------------------ | -------- | -------- | ---------- | -------------- |
      | シングルスカル     | 1x       | 1        | 無         | スカル         |
      | ダブルスカル       | 2x       | 2        | 無         | スカル         |
      | ペア               | 2-       | 2        | 無         | スイープ       |
      | 付き\*ペア         | 2+       | 3        | 有         | スイープ       |
      | クォドルプル       | 4x       | 4        | 無         | スカル         |
      | 付き\*クォドルプル | 4x+      | 5        | 有         | スカル         |
      | フォア             | 4-       | 4        | 無         | スイープ       |
      | 付き\*フォア       | 4+       | 5        | 有         | スイープ       |
      | エイト             | 8+       | 9        | 有         | スイープ       |

  - 競技環境として、漕艇場の他、河川や湖、池などの自然の水域が競技に使われることが多い
    - 水域に設けられた直線コースを片側航行で往復して使用することが多い

- ローイング競技の現状
  - 昨今、スポーツにおける安全管理に関心が集まっている
  - ローイングにおいても安全管理の重要性が認識されガイドラインの策定や競技者の安全意識向上のための教育などが行われている
  - しかしながら、ローイングにおける事故は依然として発生している
    - 英国ローイング協会の統計データによると年間このくらいの事故が発生している
      - 特に衝突事故はこのくらい起きている
    - 事故の原因としては競技者のヒューマンエラーが多い
      - 航行ルールの不遵守・後方確認の怠り・障害物の見落としなど
    - ヒューマンエラーが起きやすい要因として以下が考えられる
      - 競技の特性
        - 後方を向いており常に前方の状況を把握するのが難しいこと
        - 視点が低いため距離感がつかみにくいこと
      - 自然環境の影響
        - 天候や日照による視界不良
        - 風や水流による航路への影響
  - 人の意識に依る事故防止策だけでは十分に衝突事故を防ぐことは困難である
  - 人の意識に依らない新たな衝突防止策が求められている

### 1.2 研究目的

- 本研究の目的 // もう少し内容を広げたい
  - 低コストで練習の質を損なわない、スマートフォンを用いたローイング競技向け衝突防止システムを開発し、競技の安全性を向上すること // ローイング競技向けとは具体的にどのようなものか
  - システムを実現する上での課題を明らかにすること
- 本研究の貢献
  - ...
  - ソースコードの公開

### 1.3 本論文の構成

- 本論文は、全 7 章で構成される
- 第 2 章では、ローイング競技に関する前提知識と、本研究に関連する既存の衝突防止システムを紹介する
- 第 3 章では、提案する衝突防止システムの概要とアーキテクチャ、衝突警告アルゴリズムを提案する
- 第 4 章では、提案システムの実装について詳解する
- 第 5 章では、提案システムを実装する上で必要となる予備実験を行い、実装に必要なパラメータ値を求める // もっと具体的に述べていい
- 第 6 章では、提案システムを〇〇の観点から評価する
- 第 7 章では、本研究の結果をまとめ、今後の課題を述べる

## 第 2 章 前提知識・既存システム

### 2.1 現状の衝突防止策

- ローイングにおいて現在とられている衝突防止策には次のようなものがある
  - 一定時間・ストローク間隔で後方確認を行う
  - 団体を跨いで水域ごとに航行ルールを定める
    - 水域の片側航行
    - 高速艇が水域の中央、低速艇が水域の外側を航行
    - 視界不良時はライトを船首・船尾に点灯
  - 陸やモーターボートからの監視・警告
  - これらの衝突防止策を遵守することである程度の安全は確保できる
- 現状の対策の課題
  - 後方確認の失念
  - 障害物や他艇の見落とし
  - 不注意による航行ルールの不遵守
  - 陸や水上からの監視が難しい環境・条件

### 2.2 既存のローイング競技向け衝突防止システム

- Rowcus の紹介
  - 概要
    - ローイング競技向け衝突警告デバイス
    - RiDAR を搭載した組み込みデバイスを艇の船首に装着
    - 艇の前方にある障害物を検知し、衝突の可能性がある場合に音声により警告を発する
      - 警告音は「right」「left」の 2 種類でどちらに避けるかを指示
    - Bluetooth によるペアリングや配線等は必要ない
    - USB で充電可能
    - 特徴・利点
      - 未知の障害物に対しても警告を発することができる
      - 視界不良時でも警告を発することができる
      - 配線やペアリング等の操作が不要で最低限の手続きで使用可能
      - 警告内容で移動するべき方向がわかる
      - 他艇あるいはあらかじめビーコン等を設置する必要がない
  - 課題
    - 専用デバイスであることや RiDAR を使用しているため金銭的なコストが高い（と考えられる）
    - 艇速を考慮した警告をしていない
      - 艇速が速い場合は早めに警告したい
      - 艇速が遅い場合は遅めに警告したい
    - 前方方向の衝突の可能性しか考慮していない
      - 他艇が接近してくるなど、前方方向以外からの衝突の可能性もある
    - 水中障害物の検知が難しい

### 2.3 スマートフォンを用いた船舶向け事故防止システム

- SmartAIS
  - 概要
    - スマートフォンを用いた船舶向け事故防止システム
    - スマートフォンの位置情報と AIS を連携させ、船舶間で位置情報を共有し、衝突を予測し音声により警告するシステム
    - AIS とは
      - AIS（Automatic Identification System：船舶自動識別装置）とは、船舶の位置、速度、進行方向などの航行情報を VHF（超短波）帯の電波で自動的に送受信するシステムである
      - 国際海事機関（IMO）により、国際航海に従事する 300 総トン以上の全ての船舶、および国内航海に従事する 500 総トン以上の全ての船舶への搭載が義務付けられている
      - 各船舶は自身の情報を定期的に送信し、周辺船舶の情報を受信することで、船舶間の位置関係を把握し、衝突防止に活用している
      - 送受信される主な情報には以下のようなものがある
        - 静的情報：船舶の識別番号（MMSI）、船名、船種、船の大きさなど
        - 動的情報：位置（緯度・経度）、速度、進行方向、航海状態など
        - 航海関連情報：目的地、到着予定時刻、喫水など
    - 小型船舶は AIS を搭載していないことが多いが、このシステムは安価に使用可能なスマートフォンを AIS を連携させることで小型船舶でも AIS 情報を利用して衝突防止を行えるようにしている
      - AIS は大型船舶や港内での航行には必須であるが、小型船舶や港外での航行には必須ではない
      - AIS を利用するための機材は高額であり、小型船舶ではあまり使用されない
      - このシステムは安価に入手可能なスマートフォンを AIS と連携させることで小型船舶でも AIS 情報を利用して衝突防止を行えるようにしている
    - 衝突警告アルゴリズム
      - 規定の領域に他艇が侵入したら警告
      - 自船の全長を L として、左右後方 4L、前方 12L を危険エリアとして設定
      - 周囲 3km×3km 内を注意エリアとして設定
      - 互いの船舶の速度は考慮していない
    - 陸地に対する接近も警告してくれる
    - 特徴・利点
      - 小型船舶に向けた衝突防止システムである
      - AIS と連携しているため、AIS を利用している船舶との衝突防止が可能である
      - 安価であり身近なデバイスであるスマートフォンを使用しておりコストが低い
  - 課題 // このシステムをローイング競技に適用する場合の課題
    - 船速を考慮した衝突警告アルゴリズムでない
    - 小さなスケールの障害物との衝突を考慮していない
    - キャリア電波の圏外だと他艇の位置情報が取得できない

## 第 3 章 提案システム

### 3.1 システム要件

- 要件 // ナンバリング？／研究目標と対応付けさせる？

  - 他艇および障害物との衝突を回避することができる
  - 容易に導入できる
    - システムの調達が容易である
    - 導入費用が低い
  - 競技のパフォーマンスを必要以上に低下させない
    - 選手の集中力を過度に乱さない
      - 警告が適切なタイミングで発せられる
      - 不要な警告を最小限に抑える
    - 操作が最小限である
  - 拡張性がある // 補助的な要件
    - 艇の位置把握
      - 監視やコーチング
    - 救助要請などの緊急通報
    - 航行ログ
      - 衝突事故時の状況把握
      - 練習状況の記録や分析

- 想定状況・前提条件

  - ローイングの練習中を想定し試合中の使用は考慮しない
  - 水域は漕艇場の他、河川や湖、池などの自然の水域も想定
  - 衝突防止の対象となるもの
    - 他艇との衝突
    - 既知の静的障害物
      - e.g. 橋脚、消波ブロック、ブイなど
  - 衝突警告の対象とならないもの
    - 競技艇以外の船舶
      - e.g. モーターボート
    - 競技艇以外の動的障害物
      - e.g. 漂流物など

### 3.2 システム設計 // 基本設計にあたるイメージ

- 設計

  - 技術選定
    - 衝突防止技術として次のような技術が挙げられる
      - カメラ
      - レーダー
      - GPS
      - 超音波センサー
      - ミリ波レーダー
      - BLE
      - 加速度
      - LiDAR
      - 地磁気
  - スマートフォンの活用

    - スマートフォンは先述のいくつかの技術を利用可能である
    - センサに加えて通信機器・データ処理・警報機としても利用可能である
    - 本システムではスマートフォンを採用する
    - 導入容易性と拡張性を満たす or 高めることができる
      - 導入容易性
        - 個人が既に持っているスマートフォンを利用可能
      - 拡張性
        - インターネットを介した情報記録・共有が容易

  - システムの概要

    - スマートフォンで位置情報を取得し、サーバーを介して位置情報等を共有
    - 他艇や障害物との衝突の可能性が高い場合に警告を発する
      - 衝突警告アルゴリズムにより警告を発するか否かを判断する
    - 本システムのアプリを各艇のクルー 1 名がスマートフォンにインストール
    - 初期設定で障害物領域をあらかじめ登録
    - 登録された障害物領域の情報はサーバーに保存され、他のアプリに共有される
    - 各クルーはスマートフォンを艇上に持ち込み、アプリのナビゲーションを開始する
    - アプリはスマートフォンの位置情報および速度、方位角を取得し、サーバーに送信する
    - アプリはサーバーから他艇の位置情報および速度、方位角を取得する
    - アプリは衝突警告アルゴリズムにより衝突の可能性が高い場合に警告を発する
      - 毎秒ごとに衝突警告アルゴリズムを実行する

  - システム構成

    - システム構成図
      - システムはスマホ端末(P)とサーバー(S)で構成される
    - 各構成要素の役割
      - スマートフォン(P)
        - 障害物領域の登録
        - 艇情報の取得
        - 艇情報の共有
        - 衝突の危険性の判定
        - 警告
      - サーバー(S)
        - 障害物領域の登録
        - 艇情報の共有

  - 衝突警告アルゴリズム
    - 概要
      - 警告を発するか否かの判定を行うアルゴリズム
      - 衝突の危険性が高い場合に警告を発する
      - 衝突対象は他艇と障害物
    - コンセプト
      - 艇の一定の周辺領域に他艇あるいは障害物が侵入した場合に警告を発する
      - 艇速を考慮して警告を発するタイミングを調整する
        - 艇速が速い場合は早めに警告する
        - 艇速が遅い場合は遅めに警告する
        - 固定領域の欠点 // 領域について別で述べるなら不要
      - 段階的に警告を発する
    - アルゴリズム
      - 領域
        - アルゴリズムを記述する上で必要な領域を定義する
        - 3 つの領域を定義する
          - 船体領域
            - 艇のオールを含めた船体が占める領域
          - 排他領域
            - 静止状態の艇が他艇や障害物を避けるために必要な領域
          - 障害物領域
            - 障害物が占める領域
      - アルゴリズム // もうちょっと整理したい
        - 前提
          - 自艇は現在の進路を維持すると仮定する
          - 他艇は現在の速度と進路を維持すると仮定する
        - 手順
          - 現在の時刻を 0、自艇の速度を v、他艇の速度を u とする
          - 停止距離を SD、注意距離を AD=SD+v\*AT とする
          - AT は停止距離に差し掛かるまでの猶予時間
          - 自艇が現在の速度と進路を維持すると仮定して、他艇の船舶領域が自艇の排他領域に侵入するか否かを判定する
          - 侵入する場合はその時刻を t、衝突までの距離を CD とする
          - 警告条件
            - SD < CD <= AD: 注意の警告を発する
            - CD <= SD: 停止の警告を発する
          - この警告条件に従い警告するか否かを判定
          - 注目する艇を自艇と他艇の 2 艇に分けて、それぞれの艇に対して衝突警告アルゴリズムを実行する
    - 既存の衝突警告判定手法 // 掲載するか否か悩む
      - 固定領域
        - 固定の領域を設定し、その領域に他艇あるいは障害物が侵入した場合に警告を発する
        - 避航や停止などの衝突回避を行うのに十分余裕のある領域幅を設定する
        - 海上船舶など、水域が十分に広く船舶同士の接近が稀であるような場合に有効
        - しかし、ローイングは比較的狭い水域で競技を行うため、艇同士あるいは艇と障害物との接近がある程度許容されなければならない
      - 動的領域
        - 艇の速度を考慮して領域を設定し、その領域に他艇あるいは障害物が侵入した場合に警告を発する
        - CPA（Closest Point of Approach：最接近点）に触れるか否か...
        - ...

### 3.3 実装

- 提案するシステムの評価実験を行うためシステムの実装を行う
- システムはアプリケーションとサーバ・データベースで構成される
- 開発環境

  - スマートフォンの OS は一般的に使用されている Android 及び iOS を動作対象とする
  - 開発効率を高めるため、同一のプログラムを複数の OS 上で動作させることができるクロスプラットフォームフレームワークである Flutter を使用する
  - サーバ・データベースとして Google の提供する BaaS である Firestore を使用する

  | 項目                 | 使用技術         |
  | -------------------- | ---------------- |
  | フレームワーク       | Flutter (3.7.12) |
  | 言語                 | Dart (2.19.6)    |
  | サーバ・データベース | Firestore        |

- システムの実装詳細
  - アプリケーション
    - ユーザーインターフェース
      - 画面
        - メイン画面
        - 障害物領域設定画面
        - ナビゲーション画面
    - 障害物領域の登録
    - ナビゲーション
      - 艇情報の登録
      - 艇の表示
      - 位置情報の取得
      - 速度の取得
      - 方位角の取得
        - スマートフォンの地磁気情報を利用すると精度が保証されない
      - 艇情報の共有
      - 艇情報の取得
      - 衝突警告アルゴリズム
        - 領域の実装
          　- GoogleMapsAPI の Polygon
        - ポリゴンの重複判定
        - 衝突予測
          - 停止距離までステップに分割
      - 警告
        - 音声による警告
        - 警告種別と形式
  - サーバ・データベース
    - データベース
      - Firestore で NoSQL
    - 障害物領域の登録
      - 点群を記録
    - 艇情報の共有
      - ナビゲーション中の艇情報をリアルタイムで反映

## 第 4 章 予備実験

### 4.1 停止距離計測

- 実験概要
- 実験目的
- 実験方法
- 実験結果
- 考察

### 4.2 測位精度計測

- 実験概要
- 実験目的
- 実験方法
- 実験結果
- 考察

## 第 5 章 評価実験

### 5.1 実験目的

- 実験目的
  - 研究目標（より詳細に）がどの程度達せられているかを定量・定性的に評価する
  - 提案システムの課題を明らかにする
    - e.g. 消費電力が大きい
    - e.g. 静止時は鳴る必要がない

### 5.2 実験方法

- 評価指標
  - 研究目標と対応した評価項目・指標を設ける

### 5.3 実験結果

- 実験結果を淡々と掲載

### 5.4 考察

- 各指標について考察して評価
  - システム自体の課題を把握する
- システムを実現するにはこういう課題があるよ
  - システムを実現する際の課題を明確にする

## 第 6 章 結論

### 6.1 まとめ

- 本研究ではこういう目的を達成するためこんなシステムを作った
- また予備実験ではこういうことがわかった
- その上で評価実験を行いこれらの結果が得られこういうことが考察できた
- また課題としてこのような点が明らかになった

### 6.2 今後の課題

- 本システムで実現しきれなかった機能
  - 陸地との衝突防止が実装できていない
    - GoogleMaps の API である地点の地理属性が取得できるとかできないとか
    - 正確な地理属性を高頻度で取得する必要があるができるのか？
- 本システムの課題 // システム自体の課題
- 衝突防止システムを実現する上での一般的な課題
  - 圏外だと他艇の位置情報が取得できない

## 参考文献
