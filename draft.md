## 概要

IoT 機器の増加に伴い、マルウェアによる IoT 機器への攻撃リスクが高まっている。IoT とは、実世界のモノをインターネットに接続し、インターネットを介して情報を相互にやり取りできるようにするという考え方である。マルウェアの分野はコンピュータの普及に伴い盛んに研究が行われてきた領域ではあるが、IoT 機器を攻撃対象としたマルウェアが盛んに研究されるようになったのは IoT 機器が普及してきたここ数年のことである。パーソナルコンピュータの多くが x86_64 プロセッサで動作している一方で、IoT 機器の多くは ARM プロセッサで動作している。従来のマルウェアの解析・検出手法では、アーキテクチャが異なるため容易に応用することができない。IoT 機器を攻撃対象としたマルウェアの更なる研究が求められている。
そこで本研究では、IoT 機器の実環境を想定した 3 つの実行環境においてマルウェアがどのような影響を与えるのかを定量的に示すことを目的として、評価手法の提案とその手法を用いた評価実験を行う。評価対象となる環境として、ラズビアン環境、コンテナ環境、ユニカーネル環境を提案し、それぞれの環境においてマルウェアを実行した際に、実行環境やサービスにどのような影響を与えるのかを定量的に評価する。評価指標として実行の可否及び脅威スコアを用い、マルウェアの影響の程度を計測する。各環境におけるマルウェアの影響を比較することで、3 つの実環境の特性を示すことができる。評価実験は、ラズビアン環境のみを対象に行った。環境構築として、まずエミュレータ型仮想化ソフトウェアである QEMU を用いて RaspberryPiOS を動作させ、さらに、評価時間を高速化するために評価の自動化を行った。
評価実験の結果、<実験結果>ということが分かり、<考察>と考えられる結果となった。
本研究では、IoT 機器の実環境を想定した 3 つの実行環境においてマルウェアがどのような影響を与えるのかを定量的に示す手法を提案し、ラズビアン環境において実際に評価実験を行った。今後の課題として、残る 2 つの環境でも評価実験を行うことや、脅威スコアを厳密に算出するために実際のマルウェアの振る舞いから脅威の程度を評価することなどが挙げられる。

## はじめに

1. 研究背景

   1. 昨今のマルウェア情勢
      1. ランサムウェアの被害増加  
         近年、マルウェアによる被害が増加している。特に、攻撃対象のシステムを暗号化し、復号と引き換えに金銭の支払いを求めてくるランサムウェアと呼ばれるマルウェアの活動が活発化している。ランサムウェアに感染すると、事業停止に陥ったり、機密情報が流出するなどの被害を被る可能性がある。警視庁の公開する「令和４年上半期におけるサイバー空間をめぐる脅威の情勢等について」によると、国内におけるランサムウェアによる被害の報告件数は 2020 年から年々増加しており、2022 年には 2020 年のおよそ 5 倍の 114 件の被害が報告されている*。また、情報処理推進機構（IPA）が公開している「情報セキュリティ 10 大脅威 2022」*では、組織部門において 2021 年に引き続きランサムウェアが脅威の 1 位として位置付けられており、現在のサイバー空間における大きな脅威となっている。
      2. IoT 機器におけるマルウェアの脅威  
         IoT 機器においてもマルウェアの被害は報告されている。IoT とは、実世界のモノをインターネットに接続し、インターネットを介して情報を相互にやり取りできるようにするという概念である。IoT 機器におけるマルウェアの被害の多くは、ボット型マルウェアによるものであり、感染すると DDoS 攻撃の踏み台に利用されるなどの被害が生じる。特に、2016 年頃に大規模な DDoS 攻撃を行ったことで知られるボット Mirai は、そのソースコードが公開されて以降、その亜種が出現し続けており IoT 機器にとって大きな脅威となっている。  
         IoT 機器がマルウェアに感染する原因の多くが、初期パスワードを変更していなかったりシステムの更新を行なっていないことだと考えられる。情報通信研究機構（NICT）では、感染リスクのある機器を調査し利用者への注意喚起を行う取組、NOTICE を通じてマルウェアに対する対策を講じている。
         \# IoT 機器増加の傾向についても触れる？この取り組みで改善されたが、今後も IoT 機器が増加していくことから引き続きマルウェアへの対策が必要である。
   2. マルウェア研究における研究対象の偏り

      1. OS の偏り  
         現在、既存のマルウェアに関する研究の多くが、Windows を研究対象としており、Linux といったその他の OS を研究対象にしている研究は比較的少ない\*。Windows を研究対象とする研究が多い背景としては、Windows は他の OS に比べて 利用ユーザが多く、それを狙うマルウェアが多く存在することから、積極的に研究が行われているためであると考えられる。近年、IoT 機器を狙ったマルウェアの脅威の拡大に伴い、Linux などの OS を研究対象とする研究も報告されてきているが、Windows を対象とする研究に比べて十分な議論はなされていない。
      2. アーキテクチャの偏り
         既存のマルウェアに関する研究の中で、ARM アーキテクチャ上で動作するマルウェアを研究対象とした研究は少ない。パーソナルコンピュータでは一般的に x86_64 プロセッサが用いられるのに対し、IoT 機器などの多くの組み込み機器では ARM プロセッサが用いられることが一般的である\*。IoT 機器が普及する以前、マルウェアの多くはパーソナルコンピュータを攻撃対象としていたため x86_64 アーキテクチャを対象とした研究が盛んに行われたが、ARM アーキテクチャを対象とした研究が行われるようになったのは IoT 機器を狙うマルウェアが流行してきた比較的最近のことである\*。
         マルウェアの研究において、アーキテクチャは重要な要素である。一般的にマルウェアの検出手法は特定のアーキテクチャに特化して提案されているため、既存の検出手法を異なるアーキテクチャに転用することは困難とされる。例えば、x86_64 アーキテクチャを対象にしたマルウェアの研究で提案された検出手法は、ARM アーキテクチャを対象にしたマルウェアの検出には転用できない。こうした背景から、ARM アーキテクチャを対象としたマルウェアの研究が急務となっている。

2. 研究目的と概要  
   本研究は、ARM プロセッサの IoT 機器を想定した 3 つの実行環境において、マルウェアが与える影響を定量的に評価し、環境ごとの影響を比較することを目的とする。
   はじめに、影響評価を行う上での評価対象と評価指標を定め、評価実験のための環境構築を行なった。続いて、評価対象のうち ラズビアン環境を用いて定量的なマルウェアの影響評価を行った。
   \# 影響を与える対象は実行環境だけに限らず利用者や第三者も対象になりうる。
   本研究の貢献は、\# 貢献必要？

   - ARM アーキテクチャの実環境を想定した実行環境においてマルウェアが与える影響を定量的に示した
   - 環境ごとのマルウェアの影響を比較することで各環境のマルウェアへの耐性について考察を行なった
     \# 比較まで行っていないので言い換える必要あり
     \# 影響評価の”影響”とは、システムへの操作に加えてその結果生じる影響も指す言葉

3. 本論文の構成  
   本論文は、本章を含めて全５章で構成されている。２章では、関連研究として<関連研究>について述べる。３章では、評価を行う上での評価対象と評価指標を提案し、最後に環境構築<内容変わるかも>について述べる。４章では、実験概要、実験結果、考察について述べる。５章では、本研究の結論とまとめ、今後の課題について述べる。

## 関連研究

1. IoT マルウェアの検出・分類手法
   IoT 機器を攻撃対象としたマルウェアの検出・分類手法については、既に多くの議論が行われている。以降、IoT 機器を攻撃対象としたマルウェアを IoT マルウェアと呼ぶこととする。IoT マルウェアに限らず、一般にマルウェアの解析には静的解析と動的解析の二つのアプローチが存在する。静的解析は、マルウェアのバイナリファイルから得られる構造的、意味的情報をプログラムを実行することなく分析する手法である。この手法では、アンチアセンブル、コード難読化などの解析回避手法の影響を受けやすいとされている。一方、動的解析は、マルウェアのプログラムを実行し、その挙動を観察したりデバッグを行うことで分析を行う手法である。この手法ではアンチデバッグや遅延実行の影響を受けやすいとされている。マルウェアを実行する際は一般的に、隔離された実行環境であるサンドボックス上で実行し、その挙動を分析する。本研究においても、サンドボックスを構築し動的解析による解析を行った。
   IoT マルウェアの検出・分類手法として従来から機械学習が活用されており、学習のための様々な特徴量が提案されている。その中から、三つの特徴量について取り上げる。

   - オペコード
     マルウェアの検出・分類を行う上で有効な特徴量として、オペコードが挙げられる。オペコードとはプロセッサが実行可能な命令のことであり、レジスタやオペランドを引数に取り、目的の動作を実行する。オペコードはマルウェアの検出・分類に有効なことが< survey 論文参照 >らによって示されている\*。しかしながら、オペコードは命令セット・アーキテクチャに依存しているため、比較的汎用性に欠ける特徴量であると思われる。
   - 文字列データ
     プログラムのバイナリデータの中には、文字列として印字可能な文字列が含まれている場合があり、特徴量として用いることが可能である。例えば、IP アドレスや DLL 名、エラーメッセージやコメントなどである。
   - バイト列
     バイト列はバイナリデータをバイト単位で逐次的に表現した数値列である。< survey 論文参照 >によって Windows や Linux において、いくつかのモデルが検出・分類に有効であることが示されている。一次元のバイト列を表現の形を変えて 2 次元配列にし、グレースケール画像として学習する手法なども提案されている。

2. V-Sandbox
   サンドボックスとはマルウェアや不正と思われるプログラムを実行し動的解析するための隔離された実行環境のことである。サンドボックスは、マルウェアの影響の評価やプログラムの安全性を評価する際に用いられる。< V-sandbox 論文参照 >らは、IoT マルウェアを解析するためのサンドボックス V-Sandbox を提案している。彼らが提案したサンドボックスでは一般的な IoT マルウェアの特徴として見られる C&C サーバとの通信や脆弱な端末の探索を監視することや動作に必要な共有ライブラリの動的な追加が可能となっている。C&C サーバとは、ボット型のマルウェアに感染した機器に対して攻撃命令を出すためのサーバのことである。また、V-Sandbox では複数の CPU アーキテクチャに対応した実行環境の構築が可能となっている。以降、V-Sandbox で提案されている手法の詳細を述べる。
   V-Sandbox ではまず、実行対象のマルウェアのプログラムを readelf や ldd といった解析ツールを用いて解析し、ファイルタイプや動作に必要なライブラリ、マシンの情報などを取得する。得られた情報を用いて仮想環境の設定ファイルを動的に生成し、サンドボックス及び C&C サーバを QEMU を用いて構築する。マルウェアの挙動解析では、システムコール呼び出し、ファイル操作、ネットワークトラフィック、パフォーマンスの観点について情報を記録し、レポートを自動生成することが可能である。
   V-Sandbox の有効性を評価する実験では、従来から提案されている LiSa サンドボックスに比べ、実行可能なマルウェアの数が多く、サンドボックスとしての有効性を示す結果が得られた。実行可能なマルウェアの数が従来のサンドボックスに比べて増加したのは、V-Sandbox が複数のアーキテクチャに対応していることや共有ライブラリを動的に追加していること、C&C サーバをシミュレートしていることに起因すると考えられる。また、LiSa サンドボックスや Cuckoo サンドボックスに比べ、ネットワークトラフィックやシステムコールに関する情報を多く取得していることが分かった。
   < V-sandbox 論文参照 >らは、V-Sandbox の今後の課題として、対応するアーキテクチャを更に追加することや共有オブジェクトを追加することを挙げている。

## 提案手法

\# ある程度一般的な手法として提案

1. 概要  
   本章では、ARM プロセッサで動作する IoT 機器を想定した実行環境において、定量的なマルウェアの影響評価を行うための手法と評価実験を行うための環境構築について述べる。評価対象とする実行環境は、ラズビアン環境、コンテナ環境、ユニカーネル環境の 3 つであり、いずれの環境も IoT 機器の機能としてウェブサーバを想定してウェブサーバアプリケーションをインストールする。これらの実行環境上でマルウェアのサンプルを一つずつ実行し、その振る舞いを実行の可否および脅威スコアの観点から評価する。脅威スコアは、マルウェアが与える脅威の程度を定量的に表した値のことである。
   提案した手法を用いて評価実験を行うにあたり、実験環境のひとつであるラズビアン環境について環境構築を行なった。今後、マルウェアの動的解析を行うことを想定してエミュレート型仮想化ソフトである QEMU を用いて環境の構築を行なった。また、マルウェアの実行、及び実行の可否と脅威スコアを自動で算出するプログラムを作成することで、効率的に評価実験が行える環境を構築した。

2. 評価対象
   \# 影響の評価と環境の評価の二つの言い方をしていて言い方が統一できていない感じ。その環境における影響を評価するので一応環境の評価ではあるけど...
   本研究では、ARM プロセッサで動作する IoT 機器を想定した 3 つの実行環境を評価対象とする。いずれも IoT 機器の機能としてウェブサーバを想定し、ウェブサーバアプリケーションをインストールする。ウェブサーバとしての機能を兼ね備えてた IoT 機器としては、一般的な市販ルータなどが挙げられる。また、いずれの環境も ARM プロセッサで動作させることを前提とする。
   評価対象の 1 つ目が、ラズビアン環境である。ラズビアン環境では、使用する OS として RaspberryPiOS を使用する。IoT 機器の多くがその OS として Linux を採用しており、その中でも RaspberryPiOS は多くのシェアを持っている\*。こうした背景から実行環境として RaspberryPiOS を採用した。
   評価対象の 2 つ目がコンテナ環境である。コンテナ環境では、ウェブサーバがコンテナ環境上で動作していることを想定し、コンテナ型仮想化ソフトウェアとして Docker を使用する。また、使用するイメージは、ウェブサーバとしての機能に必要最低限のパッケージを含んだものを使用する。
   評価対象の 3 つ目がユニカーネル環境である。ユニカーネルとは、OS の一種であり、特定のアプリケーションの実行に必要な最低限のライブラリや機能を搭載した軽量 OS のことである。ユニカーネル環境では、ウェブサーバがユニカーネル上で動作していることを想定する。
   以上の異なる 3 つの実行環境を評価し、比較することにより、実行環境の差異がマルウェアの与える影響にどのような変化をもたらすのか、何が変化をもたらすのかを検討することができる。
3. 評価指標

   - 影響を定量的に評価する上で 2 つの指標を設定する。1 つが、"マルウェアの実行の可否"である。マルウェアの実行の可否は、マルウェアが実行されたかどうかを測る指標である。もう 1 つが脅威スコアである。脅威スコアはそのマルウェアが実行環境やサービス、ユーザなどにどの程度脅威を与えたかを測る指標である。以降、各指標について詳しく述べる。

   1. マルウェアの実行の可否  
      マルウェアの影響を評価する上で重要な視点として、マルウェアのプログラムが正常に動作したかという点が挙げられる。マルウェアがプログラムの実行に失敗した場合、そのマルウェアがもたらす脅威は限定的、あるいは無いものと考えられる。また、プログラムが正常に動作するには適切なライブラリや権限、環境変数、その他条件が揃う必要があることから、マルウェアのプログラムが実行に成功するかどうかは実行環境に大きく依存すると考えられ、環境ごとの影響の差異を比較する上でも重要な項目となる。そこで、本研究では"マルウェアの実行の可否"を評価指標として設定する。
      \# 環境の特性がよく現れる指標であるため環境の比較する上で有効な項目であるということ
      マルウェアの実行の可否では、各マルウェアを実行可能、もしくは実行不可の 2 種類に分類する。分類を行う際のフローチャートを図 < N > に示す。まず、マルウェアを実行し、そもそも実行可能なファイル形式ではないプログラムについては実行不可として分類する。実行できたもののうち、異常終了したものについては実行不可として分類する。正常終了したものについては実行可能とし、一定時間処理が継続しているものについてもプログラムが正常に動作しているとみなして実行可能と分類する。
      <フローチャートの図 N>
      \# ウイルスが発症する度合い
      \# 対象のマルウェアが実行ファイルであることを大前提にしてたけど提案手法の段階で前提として述べておく？

   2. 脅威スコア  
      本研究では、実行したマルウェアがもたらす脅威の程度を"脅威スコア"として定量化する。尚、本来であればマルウェアの脅威の程度を計測する場合、システムコール呼び出しやパケットの監視などを行い、実際にどのような脅威が発生したかを観測した上で脅威の程度を定量化するのが自然であが、本研究では著者の技術不足のためマルウェアの実際の振る舞いについては観測せず、マルウェアの分類に従った希望的観測による脅威の定量化を行った。
      脅威スコアは次のように導出する。まず、"マルウェアの実行の可否"において実行可能であったマルウェアについては、そのマルウェアの分類に応じた相応の脅威が発生したと仮定し、分類に応じた脅威スコアを設定する。マルウェアの分類はインターネット上で提供されているウイルス解析サービスを利用して解析する。分類に応じた脅威スコアを表 < N > に示す。表 < N >では、一般に脅威が大きいとされるランサムウェアやバックドアの脅威スコアが大きく設定されており、アドウェアやコインマイナーといった比較的脅威が小さいと考えられるものについては脅威スコアが小さく設定されている。表 < N > を作成するにあたり、セキュリティサービスを提供している企業が公開しているマルウェアの脅威の分類表を参考にした\*。続いて、"マルウェアの実行の可否"において実行不能であったマルウェアについては、そのマルウェアの脅威は発生しなかったと仮定し、脅威スコアは 0 と判断する。
      <分類と脅威スコアの対応表 N>
      <こちらもフローチャート的なものがあった方がいいかも>
      \# ウイルスがどの程度重症化するか
      \# 0 とするのやめる？

4. 環境構築  
   ラズビアン環境を用いた評価実験を行うにあたり、実験環境の構築と実行の可否及び脅威スコア導出の自動化を行った。

   1. ラズビアン環境の構築
      ラズビアン環境の構築は図 < M > のような構成で行った。まず、Ubuntu 上で QEMU を動作させ RaspberyPiOS をエミュレートした。QEMU とは、オープンソースのエミュレータ型仮想化ソフトウェアであり、様々なアーキテクチャをエミューレートすることができる。QEMU はマルウェアの動的解析を行う環境として提案されており*、そのためのプラグインも多く提供されている*。本研究では今後、マルウェアの動的解析を行うことを想定して QEMU を採用した。以降、エミュレートした RaspberyPiOS 環境をゲスト環境と言う。続いて、ゲスト環境にウェブサーバアプリケーションとして、Nginx をインストールした。Nginx は、オープンソースのウェブサーバアプリケーションであり、世界で広く利用されているソフトウェアである。次に、マルウェアのサンプルをゲスト環境に転送することや評価を自動化することを考慮して、ホスト環境からゲスト環境に SSH 接続できるように QEMU 及び RaspberyPiOS の設定を行った。
      <ラズビアン環境の構成図 M>

   2. 評価の自動化
      評価実験では、数百個のサンプルを評価することを想定しており、手動で評価を行うには時間が掛かる。そのため、ゲスト環境の立ち上げ、マルウェアの転送、実行、評価を自動化した。自動化の構成図を図< S >に示す。まず、実行環境を同じにするため、サンプルごとに新しいゲスト環境を立ち上げる必要がある。ゲスト環境を立ち上げた後、マルウェアを SCP コマンドで転送し、SSH コマンドを用いてマルウェアを実行する。SSH コマンドの終了ステータスからプログラムが正常終了したかどうかを判定することができるため、終了ステータスが 0 または 124 であれば実行可能、終了ステータスがそれ以外であれば異常終了として"マルウェアの実行の可否"を求める。終了ステータスの 0 はプログラムが正常に終了したことを示しており、124 はプログラムがタイムアウトしたことを示す。次に、マルウェアの脅威スコアを求める。マルウェアの実行の可否において実行不可と判定されたものについては脅威スコアは 0 とし、実行可能と判定されたものについては、インターネット上で公開されているマルウェアの検体 DB である VirusShare でそのマルウェアがどの分類に分類されるかを求め、表< N >の分類と脅威スコアの対応表に基づいて脅威スコアを設定する。VirusShare では、複数のマルウェア解析サービスの解析結果を取得することができる。その解析結果から文字列のパターンマッチングにより最も合致数の多い分類をそのマルウェアの分類とした。最後に、求めた脅威スコアは CSV 形式で出力した。
      マルウェアの実行の可否を元に脅威スコアを求める工程は Python プログラムを用い、その他については BashShell スクリプトを用いて自動化を行った。
      <自動化の図 S>

## 評価

\# 実際に行った具体的な事象について記述

1. 実験概要
   本節では、評価実験の概要について述べる。本実験の実験環境を表< T >に示す。評価に使用するサンプルとして、VirusShare で管理されているマルウェアのうち ARM アーキテクチャ上で動作するマルウェアのみをまとめた IoT_ARM リポジトリ\*のサンプルを用いた。実験に使用したマルウェアのサンプルの内訳を表< U >に示す。評価を行う上で、実行可能な形式でないサンプルについては除外した。
   <実験環境のバージョン等をまとめた表 T>
   <ファイルの形式の内訳をまとめた表 U>
   \# dynamically ではなく ELF（EXECTABLE） のみを抽出するのが妥当 -> readelf で解析
   \# フローチャートにまとめる？
   また、マルウェアの実行の可否を求める際に無限ループと判定する時間の長さは 10 秒とした。

2. 実験結果
   < n >個のサンプルについての実験結果を表< U >に示す。
   <実験結果をまとめた表 U>

   - 実験結果の事実のみを示す
   - 実行の可否や脅威スコア以外にもどのくらい時間が掛かったかなど
   - ほとんどがセグフォだったとかの予備情報も加えて

3. 考察
   - 実行に失敗したマルウェアの原因と考えられるもの  
     \# より詳細に解析するのもひとつ／これはあくまでサブ的な考察
   - 他の環境との比較

## おわりに

1. 結論とまとめ
   本研究では、ARM プロセッサの IoT 機器を想定した 3 つの実行環境において、マルウェアが与える影響を定量的に評価する手法を提案し、ラズビアン環境について実際に評価実験を行い、その結果を考察した。本研究の調査から、<わかったこと／マルウェアが実行失敗する原因など>ということが分かった。

2. 今後の課題
   今後の課題として、以下の 3 点が挙げられる。

   - 脅威スコアを希望的観測ではなくマルウェアの振る舞いに基づいて算出すること
   - コンテナ環境及びユニカーネル環境についても評価実験を行うこと
   - 各環境における影響評価を比較し環境の特性を考察すること
     \# もう少しありそう

   1 つ目の課題について述べる。本研究で提案した手法では、脅威スコアをマルウェアの実際の振る舞いではなく分類に基づいて算出した。しかし、この算出方法は希望的観測によるものであり実際の振る舞いを反映していない。より厳密な評価を行うためには、システムコール呼出しや外部との通信、ファイル操作といった実際の振る舞いを解析し、脅威の程度を算出することが必要である。  
   2 つ目の課題について述べる。本研究では評価対象である 3 つの環境のうちラズビアン環境のみを対象にマルウェアの影響評価を行った。提案手法の有効性を示すためには残り 2 つの環境についても同様の手法により評価を行い、提案手法がマルウェアの影響を評価する上で有効な手法であることを示す必要がある。
   3 つ目の課題について述べる。本研究ではラズビアン環境についてのみ影響評価を行いその結果を示したが、各環境の特性を議論するためには残る 2 つの環境についても評価実験を行いそれらの結果を比較することが必要である。

## 参考文献

- V-Sandbox
- A Survey on Cross-Architectual

---

## メモ

- サンプルは検体やデータセットとした方がいい？
